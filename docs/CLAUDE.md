# Руководство по разработке для Claude

## Общая суть проекта

Мы реализуем **Avito Tasker** - Telegram Mini App для заработка на выполнении простых задач в Avito.

**Суть:** Пользователи берут задачи, отправляют сообщения на Avito, загружают скриншоты и получают деньги после модерации.

**Технологии:**
- Frontend: React 18 + TypeScript + Vite + Tailwind CSS + @twa-dev/sdk
- Backend: FastAPI + asyncpg (NOT SQLAlchemy)
- Database: PostgreSQL (удаленный сервер)
- Принцип: KISS (Keep It Simple, Stupid)

---

## Главные правила разработки

### 1. ПЕРЕД НАЧАЛОМ КАЖДОГО БЛОКА

**ОБЯЗАТЕЛЬНО:**
- Открой и внимательно изучи соответствующую документацию:
  - `@docs/RED.md` - полное описание проекта
  - `@docs/main.md` - детальная логика каждой страницы
  - `@docs/tech-stack.md` - технические решения
  - `@docs/plan.md` - план реализации

- Продумай ИМЕННО ТУ информацию, которая пригодится для текущего блока
- Не делай предположений - проверяй в документации

**Если блок связан с UI/дизайном:**
- ОБЯЗАТЕЛЬНО смотри в папку `@design/` на фотографии (screen.png)
- Доступные папки дизайна:
  - `@design/main/` - главная страница
  - `@design/money/` - модалка вывода средств (2 варианта: карта и СБП)
  - `@design/one_task/` - страница деталей задачи
  - `@design/referal/` - реферальная программа
  - `@design/work_with_tasks/` - страница списка задач
- В каждой папке есть `code.html` с HTML+Tailwind кодом и `screen.png` со скриншотом

### 2. Технические требования

**База данных:**
- Используем ТОЛЬКО asyncpg (НЕ SQLAlchemy!)
- Прямые SQL-запросы без ORM
- Все запросы асинхронные через connection pool

**Telegram WebApp:**
- Авторизация через initData validation (HMAC-SHA256)
- Передача initData в заголовке Authorization: "tma {initData}"
- Реферальный код из start параметра: ref_TELEGRAM_ID

**Ссылки на Avito:**
- НЕ открываем через window.open()
- Только КОПИРОВАНИЕ в буфер обмена через clipboard API
- Уведомление "Ссылка скопирована"

**Цены и инструкции:**
- Все приходят с бэкенда из конфига (НЕ хардкодить!)
- Простая задача: 50₽ (по умолчанию)
- Задача с номером: 150₽ (по умолчанию)

### 3. Важные особенности логики

**Баланс:**
- Два типа: main_balance + referral_balance
- Отображаем СУММУ обоих
- При выводе НЕ вычитаем сразу (только после одобрения админом)

**Задачи:**
- Лимит 10 активных задач одновременно
- Блокировка на 24 часа при взятии
- Автовозврат в пул если не отправлено за 24 часа
- Проверка автовозврата при КАЖДОМ API запросе (middleware)

**Скриншоты:**
- Минимум 1, максимум 5 на задачу
- Хранение локально на сервере (НЕ в БД)
- Формат PNG, JPG, до 10 МБ

**Реферальная программа:**
- Одноуровневая (только прямые рефералы)
- 50% от КАЖДОГО заработка реферала
- Начисление автоматически при одобрении задачи реферала

**Модерация:**
- Все задачи - вручную через БД
- Все выводы - вручную через БД
- SQL-инструкции в MODERATION.md

### 4. Порядок реализации

**Frontend first:**
1. Сначала полностью реализуем frontend с моками
2. Тестируем все страницы и переходы
3. Потом создаем backend
4. В конце подключаем frontend к backend

### 5. Код-стайл и подход

- Минимум зависимостей
- Простые и понятные решения (KISS)
- Валидация данных на ОБОИХ уровнях (frontend + backend)
- Понятные сообщения об ошибках для пользователя
- Обработка всех edge cases
- НЕ использовать эмодзи в коде (только если явно требуется в UI)

### 6. Что НЕ делать

❌ НЕ использовать SQLAlchemy - только asyncpg
❌ НЕ создавать дополнительные файлы без необходимости
❌ НЕ хардкодить цены и настройки - только из конфига
❌ НЕ делать предположений - проверяй в документации
❌ НЕ упоминать "MVP" - это полноценная реализация
❌ НЕ открывать Avito ссылки - только копирование

### 7. Тестирование

После каждого блока:
- Проверь, что все работает
- Проверь соответствие дизайну (если UI блок)
- Проверь соответствие логике из документации
- Проверь обработку ошибок

---

## Примеры правильного подхода

**✅ Правильно:**
1. Читаю документацию для блока "Главная страница"
2. Смотрю design/main/screen.png для понимания UI
3. Изучаю логику из docs/main.md
4. Реализую с учетом ВСЕЙ информации
5. Тестирую

**❌ Неправильно:**
1. Сразу начинаю писать код
2. Делаю предположения о логике
3. Не смотрю на дизайн
4. Хардкожу значения

---

## Структура документации

- `docs/RED.md` - полное описание проекта, типы задач, роли
- `docs/main.md` - детальная логика работы каждой страницы
- `docs/tech-stack.md` - технические решения, credentials, env variables
- `docs/plan.md` - план реализации по блокам
- `design/*/` - UI дизайн каждой страницы

---

**Помни: Простота, документация и KISS - наши главные принципы!**
